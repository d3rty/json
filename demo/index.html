<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>d3rty/json ðŸ§¼ Demo</title>

    <!-- HTMX v2 -->
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>

    <!-- Prism.js for syntax highlighting -->
    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/themes/prism.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-go.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-json.min.js"></script>

    <style>
        body {
            font-family: sans-serif;
            margin: 2rem auto;
            padding: 0 1rem;
            max-width: 1000px;
        }
        .container {
            display: flex;
            gap: 1rem;
        }
        .pane {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        pre {
            background: #f4f4f4;
            padding: 1rem;
            overflow-x: auto;
            border-radius: 4px;
            margin: 0;
            flex: 1;
        }
        .json-input, .json-container {
            border: 1px solid #ccc;
            outline: none;
            cursor: text;
            white-space: pre;
            font-family: monospace;
        }
        .model-code {
            margin: 1rem 0;
        }
        .form-footer {
            display: flex;
            justify-content: center;
            margin-top: 1rem;
        }
        .clean-button {
            padding: 1rem 2rem;
            font-size: 1.25rem;
            cursor: pointer;
        }
    </style>
</head>
<body>

<h1>d3rty/json ðŸ§¼ Demo</h1>
<p>Below is the fixed model weâ€™ll unmarshal into:</p>

<!-- Readâ€‘only, syntaxâ€‘highlighted Go code -->
<pre class="model-code"><code class="language-go">// Event is the demo model.
type Event struct {
    dirty.Enabled
    Name     string `json:"name"`
    ID       int    `json:"id"`
    IsActive bool   `json:"is_active"`
    MustBool bool   `json:"must_bool"`
}</code></pre>

<div class="container">
    <div class="pane">
        <h2>Dirty JSON</h2>
        <pre class="json-input" contenteditable="true"><code id="json-input" class="language-json">{
  "id": "100000",
  "Is_Active": "yes",
  "must_bool": 1,
  "Name": "hello World"
}</code></pre>
    </div>

    <div class="pane">
        <h2>Clean JSON</h2>
        <pre class="json-container"><code id="output" class="language-json">{
  /* result will appear here */
}</code></pre>
    </div>
</div>

<h2>Configuration</h2>
<form id="config-form">
    <fieldset>
        <legend>Bool</legend>
        <label><input type="checkbox" name="boolEnabled" checked> Enable dirty Bool</label><br>
        <label>Fallback: <select name="boolFallback">
            <option value="false" selected>false</option>
            <option value="true">true</option>
            <option value="null">null</option>
        </select></label><br>

        <label><input type="checkbox" name="boolFromStrings" checked> FromStrings</label><br>
        <div class="nested">
            <label><input type="checkbox" name="boolCaseInsensitive" checked> CaseInsensitive</label><br>
            <label><input type="checkbox" name="respectFromNumbersLogic" checked> RespectFromNumbersLogic</label><br>
        </div>

        <label><input type="checkbox" name="boolFromNumbers" checked> FromNumbers</label><br>
        <label>ParseFunc: <select name="boolParseFunc">
            <option value="binary">binary</option>
            <option value="positive_negative">positive_negative</option>
            <option value="sign_of_one">sign_of_one</option>
        </select></label><br>
        <label><input type="checkbox" name="boolFromNull" checked> FromNull</label><br>
        <label><input type="checkbox" name="boolNullInverse"> Null Inverse</label>
    </fieldset>

    <fieldset>
        <legend>Number</legend>
        <label><input type="checkbox" name="numberEnabled" checked> Enable dirty Number</label><br>
        <label><input type="checkbox" name="numSpacingAllowed" checked> SpacingAllowed</label><br>
        <label><input type="checkbox" name="numExponentAllowed" checked> ExponentNotationAllowed</label><br>
        <label><input type="checkbox" name="numCommasAllowed" checked> CommasAllowed</label><br>
        <label>Rounding: <select name="numRounding">
            <option value="none">none</option>
            <option value="floor" selected>floor</option>
            <option value="round">round</option>
        </select></label><br>
        <label><input type="checkbox" name="numFromBools" checked> FromBools</label><br>
        <label><input type="checkbox" name="numFromNull" checked> FromNull</label>
    </fieldset>

    <fieldset>
        <legend>FlexKeys</legend>
        <label><input type="checkbox" name="flexEnabled"> Enable FlexKeys</label><br>
        <label><input type="checkbox" name="flexCaseInsensitive"> CaseInsensitive</label><br>
        <label><input type="checkbox" name="flexChameleon"> ChameleonCase</label>
    </fieldset>
</form>

<div class="form-footer">
    <button class="clean-button" type="button">Clean it ðŸ§¼</button>
</div>

<!-- Go WASM runtime -->
<script src="wasm_exec.js"></script>
<script>
	const go = new Go();
	WebAssembly
		.instantiateStreaming(fetch("main.wasm"), go.importObject)
		.then(res => go.run(res.instance))
		.catch(console.error);
</script>

<!-- Prism highlight input on edit -->
<script>
	const inputEl = document.getElementById('json-input');
	inputEl.addEventListener('input', () => {
		Prism.highlightElement(inputEl);
	});
</script>

<!-- Button handler to clean JSON -->
<script>
	document.querySelector('.clean-button').addEventListener('click', () => {
		const jsonRaw = document.getElementById('json-input').textContent;
		let out;
		try {
			out = cleanJSON(jsonRaw);
		} catch (err) {
			out = "failed to cleanJSON: " + err
		}
		const codeEl = document.getElementById('output');
		codeEl.textContent = out;
		Prism.highlightElement(codeEl);
	});
</script>

</body>
</html>